<!--
@license
Copyright (c) 2015
-->
<script>
  'use strict';
  /**
  Behaviors with a set of filters to use with Polymer 1.0 <dom-repeat>.

  ## Use

  You can use this behaviors in your custom elements in combination with a dom-repeat element:

  ```javascript
    Polymer({
      is: 'my-list',
      behaviors: [
        PinHoleBehavior
      ],
      ...
  ```

  Just add the filters and sorts to the dom-repeat element:
  ```html
  <template is="dom-repeat" items="{{ myItems }}" filter="{{ applyFilters(filterConfig) }}" sort="{{ applySorts(sortConfig) }}">
    <li><span>{{ item }}</span></li>
  </template>
  ```

  ### Properties

  Use the properties added with the behavior to customize your lists:

  ```html
  <input type="text" value={{ similarTo::input }} />
  ```

  ## Test
  You can watch the tests [here](/components/pin-hole/test/)

  @hero hero.svg
  @demo demo/index.html
  @polymerBehavior PinHoleBehavior
   */
  var PinHoleBehavior = {

    properties: {
      similarTo: {
        type: Object,
        value: {
          text: '',
          target: '',
        }
      },
      limitTo: {
        type: String,
        value: ''
      },
      filterConfig: {
        type: Object,

      },
    },

    observers: [
      'bindFilterConfig(similarTo.text, similarTo.target, limitTo)',
    ],

    // Element Behavior

    /**
     * Default filter names.
     * Override observers if you want to use another property names
     */
    bindFilterConfig: function() {
      //console.log(this.filterConfig)
      this.filterConfig = {
        'similarTo': this.similarTo,
        'limitTo': this.limitTo
      }
    },


    // TODO
    /**
     * Apply all filters
     * @param  {Object} filterConfig
     * @return {function}
     * @example
     * applyFilters(filterConfig)
     */
    applyFilters: function(filterConfig) {
      var that = this;
      return function(item) {
        var itemData = {
          item: item,
          index: this.items.indexOf(item),
        };
        var result = true;
        for (var i in Object.keys(filterConfig)){
          result = result && that.filters[Object.keys(filterConfig)[i]](itemData, filterConfig)
        }
        return result;

      };
    },

    /**
     * Applys a selected filter with its params
     * @return {Object} An array element or a function
     * @example
     * applyFilter('limitTo', myCourses, limitTo)
     */
    applyFilter: function(){
      return this.filters[arguments[0]].apply(this, Array.prototype.slice.call(arguments, 1));
    },


    /**
     * A set of filters
     * @type {Object}
     */
    filters: {

      ///////////////////
      // Items filters //
      ///////////////////

      limitTo: function(item, filterConfig) {
        var limit = filterConfig.limitTo;

        if (item.index && limit && item.index >= limit) {
          return false;
        }

        return true;
      },

      similarTo: function(item, filterConfig) {
        if (filterConfig.similarTo.text && filterConfig.similarTo.text !== '') {
          if (filterConfig.similarTo.target && filterConfig.similarTo.target !== '') {
            var compare = ~item.item[filterConfig.similarTo.target].toLowerCase().indexOf(filterConfig.similarTo.text);
            return (compare !== 0);
          }
          for (var key in item.item) {
            var compare = ~item.item[key].toLowerCase().indexOf(filterConfig.similarTo.text);
            return (compare !== 0);
          }

        }

        return true;

      },
    },

    /**
     * A set of sorts
     * @type {Object}
     */
    sorts: {

    }


  };

    // TODO
    // -Research the chance to create a entire component
    // -Make some filters & sorts behaviors which complement PinHoleBehaviors

</script>
